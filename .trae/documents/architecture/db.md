-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.activity_logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  actor_id uuid NOT NULL,
  owner_id uuid NOT NULL,
  pet_id uuid,
  action_type text NOT NULL,
  details jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT activity_logs_pkey PRIMARY KEY (id),
  CONSTRAINT activity_logs_actor_id_fkey FOREIGN KEY (actor_id) REFERENCES auth.users(id),
  CONSTRAINT activity_logs_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id),
  CONSTRAINT activity_logs_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.allergies (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  type text NOT NULL CHECK (type = ANY (ARRAY['food'::text, 'environment'::text, 'medication'::text])),
  allergen text NOT NULL,
  reaction_description text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  allergy_type character varying,
  severity_level character varying CHECK (severity_level::text = ANY (ARRAY['mild'::character varying, 'moderate'::character varying, 'severe'::character varying, 'anaphylaxis'::character varying]::text[])),
  symptoms jsonb,
  symptom_onset character varying,
  reaction_timeline text,
  triggers jsonb,
  avoidance_measures jsonb,
  safe_alternatives jsonb,
  diagnosed_by character varying,
  diagnosed_date date,
  diagnostic_test character varying,
  test_results_document_id uuid,
  current_treatment jsonb,
  emergency_medications jsonb,
  treatment_effectiveness character varying,
  quality_of_life_impact integer CHECK (quality_of_life_impact >= 1 AND quality_of_life_impact <= 10),
  seasonal_pattern jsonb,
  peak_months character varying,
  emergency_contact_plan jsonb,
  allergy_alert_enabled boolean DEFAULT true,
  vaccination_considerations text,
  vet_aware boolean DEFAULT false,
  reminder_enabled boolean DEFAULT false,
  reminder_type character varying,
  shared_with_vets jsonb,
  CONSTRAINT allergies_pkey PRIMARY KEY (id),
  CONSTRAINT allergies_test_results_document_id_fkey FOREIGN KEY (test_results_document_id) REFERENCES public.documents(id),
  CONSTRAINT allergies_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  action character varying NOT NULL,
  resource_type character varying NOT NULL,
  resource_id uuid,
  old_values jsonb,
  new_values jsonb,
  ip_address inet,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.behavior_tags (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  tag text NOT NULL,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT behavior_tags_pkey PRIMARY KEY (id),
  CONSTRAINT behavior_tags_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.beta_access_requests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  first_name text NOT NULL,
  last_name text NOT NULL,
  email text NOT NULL UNIQUE,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  status text DEFAULT 'pending'::text,
  country text,
  CONSTRAINT beta_access_requests_pkey PRIMARY KEY (id)
);
CREATE TABLE public.body_condition_scores (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  score integer NOT NULL CHECK (score >= 1 AND score <= 9),
  scale_type character varying DEFAULT '9-point'::character varying,
  assessed_date date NOT NULL,
  assessed_by character varying,
  ribs_palpable boolean,
  waist_visible boolean,
  abdominal_tuck boolean,
  category character varying,
  notes text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT body_condition_scores_pkey PRIMARY KEY (id),
  CONSTRAINT body_condition_scores_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.breeds (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  species text NOT NULL CHECK (species = ANY (ARRAY['dog'::text, 'cat'::text])),
  name text NOT NULL,
  CONSTRAINT breeds_pkey PRIMARY KEY (id)
);
CREATE TABLE public.care_notes (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  walk_routine text,
  grooming_frequency text,
  handling_tips text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT care_notes_pkey PRIMARY KEY (id),
  CONSTRAINT care_notes_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.co_owners (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  main_owner_id uuid NOT NULL,
  co_owner_id uuid,
  co_owner_email text NOT NULL,
  status text NOT NULL CHECK (status = ANY (ARRAY['pending'::text, 'accepted'::text, 'requested'::text, 'declined'::text])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  permissions jsonb DEFAULT '{"scope": "all", "pet_ids": [], "access_level": "editor"}'::jsonb,
  valid_until timestamp with time zone,
  invite_token text UNIQUE,
  role text DEFAULT 'co-owner'::text CHECK (role = ANY (ARRAY['owner'::text, 'co-owner'::text, 'viewer'::text])),
  CONSTRAINT co_owners_pkey PRIMARY KEY (id),
  CONSTRAINT co_owners_main_owner_id_fkey FOREIGN KEY (main_owner_id) REFERENCES auth.users(id),
  CONSTRAINT co_owners_co_owner_id_fkey FOREIGN KEY (co_owner_id) REFERENCES auth.users(id),
  CONSTRAINT co_owners_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.conditions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  name text NOT NULL,
  status text DEFAULT 'active'::text CHECK (status = ANY (ARRAY['active'::text, 'resolved'::text, 'recurring'::text])),
  diagnosed_date date,
  resolved_date date,
  notes text,
  severity text CHECK (severity = ANY (ARRAY['mild'::text, 'moderate'::text, 'severe'::text])),
  treatment_plan text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT conditions_pkey PRIMARY KEY (id),
  CONSTRAINT conditions_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.content (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  description text,
  type character varying NOT NULL,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'published'::character varying]::text[])),
  created_by uuid,
  reviewed_by uuid,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  reviewed_at timestamp with time zone,
  CONSTRAINT content_pkey PRIMARY KEY (id),
  CONSTRAINT content_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT content_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(id)
);
CREATE TABLE public.documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  pet_id uuid NOT NULL,
  type text NOT NULL CHECK (type = ANY (ARRAY['passport'::text, 'certificate'::text, 'prescription'::text, 'lab_result'::text, 'invoice'::text, 'insurance'::text, 'microchip_registration'::text, 'other'::text])),
  file_url text NOT NULL,
  file_name text NOT NULL,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  document_source character varying,
  document_date date,
  title character varying,
  ocr_data jsonb,
  ocr_confidence_score integer CHECK (ocr_confidence_score >= 0 AND ocr_confidence_score <= 100),
  manual_details jsonb,
  linked_records jsonb,
  tags jsonb,
  visibility character varying DEFAULT 'private'::character varying,
  shared_with_users jsonb,
  shared_with_vets jsonb,
  notify_recipients boolean DEFAULT false,
  confidentiality_level character varying DEFAULT 'normal'::character varying,
  auto_archive_date date,
  archived boolean DEFAULT false,
  document_range_start date,
  document_range_end date,
  mime_type text,
  size_bytes bigint,
  notes text,
  CONSTRAINT documents_pkey PRIMARY KEY (id),
  CONSTRAINT documents_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.emergency_contacts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  contact_type character varying,
  name character varying NOT NULL,
  relationship character varying,
  phone character varying NOT NULL,
  email character varying,
  address text,
  is_primary boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT emergency_contacts_pkey PRIMARY KEY (id),
  CONSTRAINT emergency_contacts_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.events (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  pet_id uuid,
  title text NOT NULL,
  description text,
  start_time timestamp with time zone NOT NULL,
  end_time timestamp with time zone,
  type text CHECK (type = ANY (ARRAY['vet'::text, 'grooming'::text, 'walking'::text, 'other'::text])),
  location text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  location_lat double precision,
  location_lng double precision,
  place_id text,
  cost numeric,
  currency text DEFAULT 'EUR'::text,
  location_place_id text,
  CONSTRAINT events_pkey PRIMARY KEY (id),
  CONSTRAINT events_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT events_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.favorites (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  place_id text NOT NULL,
  business_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT favorites_pkey PRIMARY KEY (id),
  CONSTRAINT favorites_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.food (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  brand text,
  food_type text CHECK (food_type = ANY (ARRAY['dry'::text, 'wet'::text, 'raw'::text, 'other'::text])),
  amount text,
  meals_per_day integer,
  feeding_times ARRAY,
  diet_notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  feeding_schedule text,
  CONSTRAINT food_pkey PRIMARY KEY (id),
  CONSTRAINT food_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.health_metrics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  pet_id uuid NOT NULL,
  measured_at timestamp without time zone,
  weight numeric,
  veterinary_consultation_needed boolean DEFAULT false,
  measured_by character varying,
  measurement_location character varying,
  length_value numeric,
  length_unit character varying,
  height_at_shoulder numeric,
  height_unit character varying,
  girth_circumference numeric,
  girth_unit character varying,
  blood_pressure_systolic integer,
  blood_pressure_diastolic integer,
  pain_score integer CHECK (pain_score >= 1 AND pain_score <= 10),
  pain_observations text,
  coat_condition character varying,
  coat_notes text,
  appetite_level character varying,
  appetite_notes text,
  hydration_status character varying,
  activity_level character varying,
  activity_observations text,
  lab_results jsonb,
  weight_change_percent numeric,
  weight_trend character varying,
  consultation_reasons jsonb,
  body_condition_score numeric,
  temperature numeric,
  temperature_unit text,
  heart_rate integer,
  respiratory_rate integer,
  date date DEFAULT CURRENT_DATE,
  weight_unit text DEFAULT 'kg'::text,
  notes text,
  energy_level text,
  stool_quality text,
  CONSTRAINT health_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT health_metrics_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.health_recommendations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  recommendation_type character varying NOT NULL,
  priority character varying NOT NULL,
  title character varying NOT NULL,
  description text,
  action_items ARRAY,
  action_button_text character varying,
  expected_benefit text,
  estimated_cost_min numeric,
  estimated_cost_max numeric,
  currency character varying DEFAULT 'USD'::character varying,
  due_date date,
  completed boolean DEFAULT false,
  completed_date timestamp without time zone,
  dismissed boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT health_recommendations_pkey PRIMARY KEY (id),
  CONSTRAINT health_recommendations_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.health_risks (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  risk_type character varying NOT NULL,
  risk_level character varying,
  risk_score integer CHECK (risk_score >= 0 AND risk_score <= 100),
  description text,
  mitigation text,
  contributing_factors ARRAY,
  first_identified date,
  last_assessed timestamp without time zone,
  status character varying DEFAULT 'active'::character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT health_risks_pkey PRIMARY KEY (id),
  CONSTRAINT health_risks_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.health_scores (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  calculated_date timestamp without time zone NOT NULL DEFAULT now(),
  overall_score integer CHECK (overall_score >= 0 AND overall_score <= 100),
  score_category character varying,
  preventive_care_score integer,
  vaccination_score integer,
  weight_management_score integer,
  data_completeness_percentage integer,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT health_scores_pkey PRIMARY KEY (id),
  CONSTRAINT health_scores_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.mail_queue (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  to_email text NOT NULL,
  subject text NOT NULL,
  body text NOT NULL,
  status text DEFAULT 'pending'::text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT mail_queue_pkey PRIMARY KEY (id)
);
CREATE TABLE public.medical_history (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  summary text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT medical_history_pkey PRIMARY KEY (id),
  CONSTRAINT medical_history_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.medical_visits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  pet_id uuid NOT NULL,
  date date NOT NULL,
  clinic_name text,
  vet_name text,
  reason text NOT NULL,
  diagnosis text,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  cost numeric,
  currency text DEFAULT 'EUR'::text,
  provider_type character varying DEFAULT 'veterinary'::character varying,
  service_category character varying,
  visit_time time without time zone,
  duration_minutes integer,
  provider_name character varying,
  business_name character varying,
  business_phone character varying,
  business_email character varying,
  business_website character varying,
  business_place_id character varying,
  business_lat numeric,
  business_lng numeric,
  distance_km numeric,
  current_medications jsonb,
  special_instructions text,
  recommendations jsonb,
  cost_breakdown jsonb,
  payment_method character varying,
  insurance_provider character varying,
  insurance_claim_status character varying,
  invoice_document_id uuid,
  attachments jsonb,
  reminder_enabled boolean DEFAULT false,
  reminder_date timestamp without time zone,
  reminder_type character varying,
  shared_with jsonb,
  CONSTRAINT medical_visits_pkey PRIMARY KEY (id),
  CONSTRAINT medical_visits_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id),
  CONSTRAINT medical_visits_invoice_document_id_fkey FOREIGN KEY (invoice_document_id) REFERENCES public.documents(id)
);
CREATE TABLE public.medications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  pet_id uuid NOT NULL,
  name text NOT NULL,
  dosage_value numeric,
  dosage_unit text,
  frequency text,
  start_date date,
  end_date date,
  reminders_enabled boolean DEFAULT false,
  cost numeric,
  currency text DEFAULT 'USD'::text,
  notes text,
  attachments ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  treatment_type character varying,
  administration_times jsonb,
  administration_instructions text,
  best_time_to_give jsonb,
  duration_value integer,
  duration_unit character varying,
  is_ongoing boolean DEFAULT false,
  strength character varying,
  form character varying,
  prescribed_by character varying,
  pharmacy_name character varying,
  pharmacy_place_id character varying,
  prescription_number character varying,
  prescription_document_id uuid,
  refill_schedule jsonb,
  auto_refill boolean DEFAULT false,
  unit_price numeric,
  quantity integer,
  total_cost numeric,
  insurance_coverage_percent integer,
  out_of_pocket_cost numeric,
  side_effects jsonb,
  severity_rating character varying,
  contraindications text,
  interactions jsonb,
  storage_instructions character varying,
  reason_for_treatment text,
  condition_being_treated character varying,
  monitor_for jsonb,
  reminder_notify_caregivers jsonb,
  reminder_before_minutes integer DEFAULT 30,
  reminder_calendar_event boolean DEFAULT false,
  CONSTRAINT medications_pkey PRIMARY KEY (id),
  CONSTRAINT medications_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id),
  CONSTRAINT medications_prescription_document_id_fkey FOREIGN KEY (prescription_document_id) REFERENCES public.documents(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  pet_id uuid,
  type text NOT NULL CHECK (type = ANY (ARRAY['vaccination'::text, 'treatment'::text, 'vet_visit'::text, 'co_owner_invite'::text, 'co_owner_request'::text, 'co_owner_accepted'::text, 'co_owner_declined'::text])),
  title text NOT NULL,
  message text NOT NULL,
  due_date timestamp with time zone,
  is_read boolean DEFAULT false,
  related_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  related_type text,
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT notifications_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.pet_photos (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  user_id uuid NOT NULL,
  url text NOT NULL,
  caption text,
  is_favorite boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT pet_photos_pkey PRIMARY KEY (id),
  CONSTRAINT pet_photos_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id),
  CONSTRAINT pet_photos_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.pet_share_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  token text NOT NULL UNIQUE,
  permission_level text NOT NULL CHECK (permission_level = ANY (ARRAY['basic'::text, 'advanced'::text])),
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone,
  accessed_count integer DEFAULT 0,
  last_accessed_at timestamp with time zone,
  CONSTRAINT pet_share_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT pet_share_tokens_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.pets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  name text NOT NULL,
  species text NOT NULL CHECK (species = ANY (ARRAY['dog'::text, 'cat'::text, 'bird'::text, 'rabbit'::text, 'reptile'::text, 'other'::text])),
  breed text,
  gender text CHECK (gender = ANY (ARRAY['male'::text, 'female'::text])),
  date_of_birth date,
  age_approximate text,
  size text CHECK (size = ANY (ARRAY['small'::text, 'medium'::text, 'large'::text])),
  weight numeric,
  color text,
  photo_url text,
  photo_gallery ARRAY,
  microchip_number text,
  registration_id text,
  is_spayed_neutered boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  blood_type text,
  address_json jsonb,
  height numeric,
  microchip_implantation_date date,
  passport_id character varying UNIQUE,
  passport_generated_at timestamp without time zone,
  passport_updated_at timestamp without time zone,
  microchip_date date,
  pet_status character varying DEFAULT 'active'::character varying,
  spayed_neutered_date date,
  tattoo_id character varying,
  coat_type character varying,
  eye_color character varying,
  distinguishing_marks text,
  ideal_weight_min numeric,
  ideal_weight_max numeric,
  CONSTRAINT pets_pkey PRIMARY KEY (id),
  CONSTRAINT pets_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  first_name text,
  last_name text,
  country_code text,
  language_code text,
  date_of_birth date,
  photo_url text,
  notification_prefs jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  address text,
  location_lat double precision,
  location_lng double precision,
  place_id text,
  gender text CHECK (gender = ANY (ARRAY['male'::text, 'female'::text, 'non_binary'::text, 'prefer_not_to_say'::text])),
  phone text,
  bio text,
  website text,
  email text,
  onboarding_completed boolean DEFAULT false,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.public_shares (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  token text NOT NULL UNIQUE,
  pet_id uuid NOT NULL,
  created_by uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  valid_until timestamp with time zone,
  settings jsonb DEFAULT '{}'::jsonb,
  views integer DEFAULT 0,
  CONSTRAINT public_shares_pkey PRIMARY KEY (id),
  CONSTRAINT public_shares_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id),
  CONSTRAINT public_shares_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.ref_allergens (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  allergen_name character varying NOT NULL,
  allergen_type character varying,
  common_reactions jsonb,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT ref_allergens_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ref_medications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  medication_name character varying NOT NULL,
  brand_names jsonb,
  active_ingredient character varying,
  category character varying,
  typical_dosage_range character varying,
  common_uses text,
  side_effects jsonb,
  contraindications text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT ref_medications_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ref_symptoms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  symptom_name character varying NOT NULL,
  category character varying,
  severity_indicator boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT ref_symptoms_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ref_vaccines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  species character varying NOT NULL,
  vaccine_name character varying NOT NULL,
  abbreviation character varying,
  vaccine_type character varying,
  typical_schedule character varying,
  booster_interval character varying,
  description text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT ref_vaccines_pkey PRIMARY KEY (id)
);
CREATE TABLE public.reference_breeds (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  species text NOT NULL CHECK (species = ANY (ARRAY['dog'::text, 'cat'::text])),
  name text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  metadata jsonb,
  CONSTRAINT reference_breeds_pkey PRIMARY KEY (id)
);
CREATE TABLE public.reference_treatments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name text NOT NULL UNIQUE,
  category text NOT NULL CHECK (category = ANY (ARRAY['preventive'::text, 'acute'::text, 'chronic'::text])),
  default_frequency text,
  validity_days integer,
  description text,
  CONSTRAINT reference_treatments_pkey PRIMARY KEY (id)
);
CREATE TABLE public.reference_vaccinations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  species text NOT NULL CHECK (species = ANY (ARRAY['dog'::text, 'cat'::text])),
  name text NOT NULL,
  category text NOT NULL CHECK (category = ANY (ARRAY['core'::text, 'non-core'::text])),
  validity_months integer DEFAULT 12,
  description text,
  CONSTRAINT reference_vaccinations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.roles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  permissions jsonb NOT NULL DEFAULT '{}'::jsonb,
  description text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT roles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  key character varying NOT NULL UNIQUE,
  value jsonb NOT NULL,
  category character varying NOT NULL,
  description text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT settings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.shared_links (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  pet_id uuid NOT NULL,
  token text NOT NULL UNIQUE,
  profile_id uuid NOT NULL,
  expires_at timestamp with time zone,
  view_count integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT shared_links_pkey PRIMARY KEY (id),
  CONSTRAINT shared_links_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id),
  CONSTRAINT shared_links_profile_id_fkey FOREIGN KEY (profile_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.translations (
  id bigint NOT NULL DEFAULT nextval('translations_id_seq'::regclass),
  namespace text NOT NULL DEFAULT 'common'::text,
  key text NOT NULL,
  language_code text NOT NULL,
  value text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT translations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.treatments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  treatment_name text NOT NULL,
  category text NOT NULL CHECK (category = ANY (ARRAY['preventive'::text, 'acute'::text, 'chronic'::text])),
  start_date date NOT NULL,
  end_date date,
  dosage text,
  frequency text,
  time_of_day text,
  vet text,
  notes text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  dosage_value numeric,
  dosage_unit text,
  provider text,
  cost numeric,
  currency text DEFAULT 'USD'::text,
  next_due_date date,
  prescribed_by character varying,
  prescription_number character varying,
  pharmacy character varying,
  refills_remaining integer,
  side_effects ARRAY,
  with_food boolean,
  special_instructions text,
  CONSTRAINT treatments_pkey PRIMARY KEY (id),
  CONSTRAINT treatments_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.user_roles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  role USER-DEFINED NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_roles_pkey PRIMARY KEY (id),
  CONSTRAINT user_roles_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.user_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  refresh_token character varying NOT NULL UNIQUE,
  ip_address inet,
  user_agent text,
  expires_at timestamp with time zone NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT user_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL UNIQUE,
  password_hash character varying NOT NULL,
  name character varying NOT NULL,
  role_id uuid,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'suspended'::character varying]::text[])),
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  last_login_at timestamp with time zone,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id)
);
CREATE TABLE public.vaccinations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  vaccine_name text NOT NULL,
  category text NOT NULL CHECK (category = ANY (ARRAY['core'::text, 'non-core'::text])),
  date_given date NOT NULL,
  next_due_date date,
  dose_number integer,
  administering_vet text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  location text,
  location_lat double precision,
  location_lng double precision,
  place_id text,
  provider text,
  batch_number text,
  cost numeric,
  currency text DEFAULT 'EUR'::text,
  administered_time time without time zone,
  manufacturer character varying,
  route_of_administration character varying,
  administered_by character varying,
  clinic_place_id character varying,
  vaccination_type character varying,
  schedule_interval character varying,
  payment_method character varying,
  insurance_provider character varying,
  certificate_document_id uuid,
  reaction_severity character varying,
  reactions jsonb,
  reminder_enabled boolean DEFAULT true,
  reminder_days_before integer DEFAULT 14,
  reminder_methods jsonb,
  reminder_recipients jsonb,
  lot_number character varying,
  clinic character varying,
  route character varying,
  injection_site character varying,
  certificate_number character varying,
  required_for_travel boolean DEFAULT false,
  CONSTRAINT vaccinations_pkey PRIMARY KEY (id),
  CONSTRAINT vaccinations_certificate_document_id_fkey FOREIGN KEY (certificate_document_id) REFERENCES public.documents(id),
  CONSTRAINT vaccinations_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.veterinarians (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  clinic_name text NOT NULL,
  vet_name text,
  address text,
  phone text,
  email text,
  website text,
  is_primary boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  type text DEFAULT 'clinic'::text CHECK (type = ANY (ARRAY['clinic'::text, 'emergency'::text, 'specialist'::text])),
  location_lat double precision,
  location_lng double precision,
  place_id text,
  city text,
  zip_code text,
  country text,
  hours text,
  emergency_available boolean DEFAULT false,
  vet_license_number character varying,
  CONSTRAINT veterinarians_pkey PRIMARY KEY (id),
  CONSTRAINT veterinarians_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);
CREATE TABLE public.weight_entries (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pet_id uuid NOT NULL,
  weight numeric NOT NULL,
  date date NOT NULL,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT weight_entries_pkey PRIMARY KEY (id),
  CONSTRAINT weight_entries_pet_id_fkey FOREIGN KEY (pet_id) REFERENCES public.pets(id)
);